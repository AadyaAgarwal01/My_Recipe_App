<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Recipe Finder by Category</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        background: var(--bg);
        color: var(--text);
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 0;
        transition: background 0.3s, color 0.3s;
      }
      :root {
        --orange: #e67e22;
        --orange-dark: #d35400;
        --red: #e74c3c;
        --bg: #f6f8fa;
        --text: #222;
        --card-bg: #fff;
        --card-shadow: rgba(0, 0, 0, 0.07);
        --pill-bg: #fffbe6;
        --pill-border: #f4d47c;
      }
      [data-theme="dark"] {
        --bg: #121212;
        --text: #eee;
        --card-bg: #1e1e1e;
        --card-shadow: rgba(0, 0, 0, 0.5);
        --pill-bg: #2a2a2a;
        --pill-border: #3a9d5f;
      }
      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--card-bg);
        box-shadow: 0 2px 8px var(--card-shadow);
        padding: 12px 24px;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .navbar-title {
        font-size: 1.5rem;
        color: var(--orange);
        font-weight: 700;
        letter-spacing: 1.5px;
      }
      .navbar-icons {
        display: flex;
        align-items: center;
        gap: 20px;
      }
      button {
        cursor: pointer;
        border: none;
        background: none;
        color: var(--orange);
        font-size: 1.7rem;
        transition: color 0.3s;
      }
      button:hover,
      button:focus {
        color: var(--orange-dark);
        outline: none;
      }
      .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--red);
        color: #fff;
        border-radius: 999px;
        font-size: 0.85rem;
        padding: 2px 7px;
        font-weight: 700;
        min-width: 22px;
        text-align: center;
      }
      .container {
        max-width: 1200px;
        margin: 32px auto;
        padding: 0 16px 48px;
      }
      h1 {
        text-align: center;
        color: var(--orange);
        margin-bottom: 32px;
        font-size: 2.8rem;
      }
      .category-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-bottom: 28px;
      }
      .category-btn {
        background: var(--card-bg);
        border: 2px solid var(--orange);
        color: var(--orange);
        border-radius: 999px;
        padding: 8px 24px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s, color 0.3s;
        position: relative;
      }
      .category-btn.selected,
      .category-btn:hover,
      .category-btn:focus {
        background: var(--orange);
        color: #fff;
        outline: none;
      }
      .category-btn[title]:hover::after,
      .category-btn[title]:focus::after {
        content: attr(title);
        position: absolute;
        bottom: -36px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--orange);
        color: #fff;
        padding: 6px 12px;
        border-radius: 8px;
        white-space: nowrap;
        font-size: 0.8rem;
        pointer-events: none;
        opacity: 0.9;
        z-index: 10;
      }
      .search-bar {
        display: flex;
        justify-content: center;
        margin-bottom: 32px;
        gap: 12px;
        flex-wrap: wrap;
      }
      .search-bar input {
        width: 320px;
        max-width: 100%;
        padding: 14px 20px;
        border-radius: 999px;
        border: 2px solid var(--orange);
        font-size: 1.1rem;
        outline-offset: 2px;
        background: var(--card-bg);
        color: var(--text);
        transition: border-color 0.3s;
      }
      .search-bar input::placeholder {
        color: #999;
      }
      .search-bar input:focus {
        border-color: var(--orange-dark);
      }
      .search-bar button {
        background: var(--orange);
        color: #fff;
        border-radius: 999px;
        padding: 14px 36px;
        font-size: 1.1rem;
        font-weight: 700;
        box-shadow: 0 4px 12px rgba(230, 126, 34, 0.4);
        transition: background-color 0.3s, box-shadow 0.3s;
      }
      .search-bar button:hover,
      .search-bar button:focus {
        background: var(--orange-dark);
        box-shadow: 0 6px 18px rgba(211, 84, 0, 0.7);
        outline: none;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 32px;
        min-height: 200px;
        position: relative;
      }
      .loading-spinner {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 3rem;
        color: var(--orange);
        animation: spin 1.2s linear infinite;
        user-select: none;
        pointer-events: none;
        z-index: 5;
      }
      @keyframes spin {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }
      .card {
        display: flex;
        flex-direction: column;
        background: var(--card-bg);
        border-radius: 18px;
        box-shadow: 0 4px 24px var(--card-shadow);
        overflow: hidden;
        min-height: 430px;
        transition: box-shadow 0.3s;
        position: relative;
        height: 100%;
      }
      .card:hover,
      .card:focus-within {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.13);
        outline: none;
      }
      .card-img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: #eee;
        user-select: none;
        pointer-events: none;
      }
      .card-body {
        display: flex;
        flex-direction: column;
        flex: 1 1 0;
        padding: 20px;
      }
      .card-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--orange);
        min-height: 3em;
        line-height: 1.2;
      }
      .card-meta {
        font-size: 1rem;
        margin-bottom: 12px;
        color: #666;
      }
      .ingredient-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 16px;
        min-height: 60px;
        align-items: flex-end;
      }
      .ingredient-icon {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 54px;
        font-size: 0.75rem;
        color: #555;
        text-align: center;
      }
      .ingredient-icon img {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--pill-bg);
        border: 2px solid var(--pill-border);
        margin-bottom: 4px;
        object-fit: contain;
        box-shadow: 0 2px 4px rgba(230, 126, 34, 0.08);
      }
      .card-footer {
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .view-btn {
        background: var(--orange);
        color: #fff;
        border: none;
        border-radius: 999px;
        padding: 8px 22px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
      }
      .view-btn:hover,
      .view-btn:focus {
        background: var(--orange-dark);
        outline: none;
      }
      .fav-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.5em;
        color: #ccc;
        transition: color 0.3s, transform 0.3s;
        margin-left: 8px;
      }
      .fav-btn.favorited {
        color: var(--red);
        transform: scale(1.3);
        animation: pop 0.3s;
      }
      @keyframes pop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.4);
        }
        100% {
          transform: scale(1);
        }
      }
      .no-results {
        grid-column: 1/-1;
        text-align: center;
        color: #888;
        font-size: 1.3em;
        margin-top: 60px;
      }
      .modal-bg {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.2s;
      }
      .modal {
        background: var(--card-bg);
        border-radius: 18px;
        max-width: 900px;
        width: 98vw;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25);
        padding: 2em 2em 1.5em 2em;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
        animation: pop 0.25s;
        transition: max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 320px;
        color: var(--text);
      }
      .modal-close {
        position: absolute;
        top: 1em;
        right: 1em;
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: var(--orange);
        transition: color 0.3s;
      }
      .modal-close:hover,
      .modal-close:focus {
        color: var(--orange-dark);
        outline: none;
      }
      .modal-img {
        width: 100%;
        border-radius: 0.7em;
        margin-bottom: 1em;
        max-height: 260px;
        object-fit: cover;
      }
      .modal-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--orange);
        margin-bottom: 0.5em;
      }
      .modal-section {
        margin-bottom: 1.5em;
      }
      .modal-ingredients {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 12px;
      }
      .modal-step {
        background: var(--bg);
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 10px;
        font-size: 1.1em;
        color: var(--text);
        border-left: 5px solid var(--orange);
      }
      .modal-bottom-row {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 20px;
        margin-top: 24px;
      }
      .modal-youtube {
        background: #ff0000;
        color: #fff;
        padding: 12px 24px;
        border-radius: 999px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        font-size: 1.2em;
        transition: background 0.3s;
      }
      .modal-youtube:hover,
      .modal-youtube:focus {
        background: #c20000;
        outline: none;
      }
      .modal-fav-btn {
        background: none;
        border: none;
        font-size: 2.2em;
        color: #ccc;
        cursor: pointer;
        transition: color 0.3s, transform 0.3s;
      }
      .modal-fav-btn.favorited {
        color: var(--red);
        transform: scale(1.3);
        animation: pop 0.3s;
      }
      .fav-modal {
        max-width: 900px;
        width: 98vw;
        color: var(--text);
      }
      .fav-modal h2 {
        text-align: center;
        color: var(--orange);
        margin-bottom: 18px;
      }
      .fav-modal .grid {
        margin-top: 0;
      }
      .fav-modal .card {
        min-height: 340px;
      }
      .fav-modal .no-results {
        margin: 40px 0 0 0;
      }
      @media (max-width: 700px) {
        .container {
          padding: 0 12px;
        }
        .card-body {
          padding: 16px;
        }
        .search-bar input {
          width: 100%;
        }
        .modal {
          padding: 1.5em 1em;
          max-width: 95vw;
        }
        .modal-youtube {
          font-size: 1em;
          padding: 10px 18px;
        }
        .modal-fav-btn {
          font-size: 1.8em;
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
  </head>
  <body data-theme="light">
    <nav class="navbar">
      <span class="navbar-title">Recipe Finder</span>
      <div class="navbar-icons">
        <button
          class="cart-btn"
          id="show-favorites"
          aria-label="Show favorites"
          title="Show favorites"
        >
          <i class="fa-solid fa-cart-shopping"></i>
          <span id="fav-count" class="cart-count">0</span>
        </button>
        <button
          id="theme-toggle"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
          style="
            font-size: 1.7rem;
            color: var(--orange);
            background: none;
            border: none;
            cursor: pointer;
          "
        >
          <i class="fa-regular fa-moon"></i>
        </button>
      </div>
    </nav>
    <div class="container">
      <h1>Recipe Finder Gallery</h1>
      <div
        id="category-bar"
        class="category-bar"
        role="tablist"
        aria-label="Recipe categories"
      ></div>
      <form class="search-bar" id="searchForm" autocomplete="off" role="search">
        <input
          type="search"
          id="searchInput"
          placeholder="Search for recipes (e.g. chicken, pasta)"
          aria-label="Search recipes"
        />
        <button type="submit" aria-label="Search recipes">Search</button>
      </form>
      <div id="cards" class="grid" aria-live="polite" aria-busy="false"></div>
    </div>
    <div id="modal-root" aria-hidden="true"></div>
    <div id="fav-modal-root" aria-hidden="true"></div>
    <script>
      (() => {
        const favoritesKey = "favorites";
        let favorites = JSON.parse(localStorage.getItem(favoritesKey) || "[]");
        let currentCategory = null;
        let debounceTimeout = null;
        const cardsContainer = document.getElementById("cards");
        const categoryBar = document.getElementById("category-bar");
        const favCountElem = document.getElementById("fav-count");
        const modalRoot = document.getElementById("modal-root");
        const favModalRoot = document.getElementById("fav-modal-root");
        const themeToggleBtn = document.getElementById("theme-toggle");

        function setTheme(dark) {
          document.body.setAttribute("data-theme", dark ? "dark" : "light");
          themeToggleBtn.innerHTML = dark
            ? '<i class="fa-regular fa-sun"></i>'
            : '<i class="fa-regular fa-moon"></i>';
          localStorage.setItem("darkMode", dark);
        }
        themeToggleBtn.onclick = () =>
          setTheme(document.body.getAttribute("data-theme") !== "dark");
        setTheme(localStorage.getItem("darkMode") === "true");

        async function fetchCategories() {
          const res = await fetch(
            "https://www.themealdb.com/api/json/v1/1/categories.php"
          );
          const data = await res.json();
          renderCategories(data.categories || []);
        }
        function renderCategories(categories) {
          categoryBar.innerHTML = "";
          categories.forEach((cat, i) => {
            const btn = document.createElement("button");
            btn.className = "category-btn";
            btn.textContent = cat.strCategory;
            btn.title = cat.strCategoryDescription;
            btn.setAttribute("role", "tab");
            btn.setAttribute("aria-selected", "false");
            btn.setAttribute("tabindex", "-1");
            btn.onclick = () => {
              Array.from(categoryBar.children).forEach((b) => {
                b.classList.remove("selected");
                b.setAttribute("aria-selected", "false");
                b.setAttribute("tabindex", "-1");
              });
              btn.classList.add("selected");
              btn.setAttribute("aria-selected", "true");
              btn.setAttribute("tabindex", "0");
              btn.focus();
              currentCategory = cat.strCategory;
              fetchRecipesByCategory(cat.strCategory);
            };
            if (i === 0) {
              btn.classList.add("selected");
              btn.setAttribute("aria-selected", "true");
              btn.setAttribute("tabindex", "0");
              currentCategory = cat.strCategory;
            }
            categoryBar.appendChild(btn);
          });
          if (currentCategory) fetchRecipesByCategory(currentCategory);
        }

        async function fetchRecipesByCategory(category) {
          clearSearchInput();
          showLoading(true);
          const res = await fetch(
            `https://www.themealdb.com/api/json/v1/1/filter.php?c=${encodeURIComponent(
              category
            )}`
          );
          const data = await res.json();
          const meals = await Promise.all(
            (data.meals || []).slice(0, 12).map(async (m) => {
              const detailRes = await fetch(
                `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${m.idMeal}`
              );
              const detailData = await detailRes.json();
              return detailData.meals ? detailData.meals[0] : null;
            })
          );
          renderCards(meals.filter(Boolean));
          showLoading(false);
          scrollToTop();
        }

        async function fetchRecipes(keyword = "chicken") {
          currentCategory = null;
          Array.from(categoryBar.children).forEach((b) =>
            b.classList.remove("selected")
          );
          showLoading(true);
          const res = await fetch(
            `https://www.themealdb.com/api/json/v1/1/search.php?s=${encodeURIComponent(
              keyword
            )}`
          );
          const data = await res.json();
          renderCards((data.meals || []).filter(Boolean));
          showLoading(false);
          scrollToTop();
        }

        function clearSearchInput() {
          const input = document.getElementById("searchInput");
          input.value = "";
        }

        function scrollToTop() {
          window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function getIngredients(meal, max = 5) {
          const ings = [];
          for (let i = 1; i <= 20; i++) {
            const ing = meal[`strIngredient${i}`];
            if (ing && ing.trim()) ings.push(ing.trim());
            if (ings.length === max) break;
          }
          return ings;
        }

        function isFavorite(id) {
          return favorites.includes(id);
        }

        function toggleFavorite(meal) {
          const idx = favorites.indexOf(meal.idMeal);
          if (idx === -1) {
            favorites.push(meal.idMeal);
          } else {
            favorites.splice(idx, 1);
          }
          localStorage.setItem(favoritesKey, JSON.stringify(favorites));
          updateFavCount();
        }

        function updateFavCount() {
          favCountElem.textContent = favorites.length;
        }

        function showLoading(show) {
          if (show) {
            if (!cardsContainer.querySelector(".loading-spinner")) {
              const spinner = document.createElement("div");
              spinner.className = "loading-spinner";
              spinner.innerHTML =
                '<i class="fa-solid fa-utensils fa-spin"></i>';
              cardsContainer.appendChild(spinner);
            }
          } else {
            const spinner = cardsContainer.querySelector(".loading-spinner");
            if (spinner) spinner.remove();
          }
        }

        function renderCards(meals) {
          cardsContainer.setAttribute("aria-busy", "true");
          cardsContainer.innerHTML = "";
          if (meals.length === 0) {
            cardsContainer.innerHTML =
              '<div class="no-results" role="alert">No recipes found.</div>';
            cardsContainer.setAttribute("aria-busy", "false");
            return;
          }
          meals.forEach((meal) => {
            const ings = getIngredients(meal, 5);
            const ingIcons = ings
              .map(
                (ing) => `
            <div class="ingredient-icon">
              <img src="https://www.themealdb.com/images/ingredients/${encodeURIComponent(
                ing
              )}.png" alt="${ing}">
              <span>${ing}</span>
            </div>
          `
              )
              .join("");
            const card = document.createElement("div");
            card.className = "card";
            card.tabIndex = 0;
            card.setAttribute("role", "article");
            card.setAttribute("aria-label", meal.strMeal);
            card.innerHTML = `
            <img class="card-img" src="${meal.strMealThumb}" alt="${
              meal.strMeal
            }" loading="lazy" />
            <div class="card-body">
              <div class="card-title">${meal.strMeal}</div>
              <div class="card-meta">${meal.strArea || ""} &middot; ${
              meal.strCategory || ""
            }</div>
              <div class="ingredient-row">${ingIcons}</div>
              <div class="card-footer">
                <button class="view-btn" aria-label="View steps for ${
                  meal.strMeal
                }">View Steps</button>
                <button class="fav-btn ${
                  isFavorite(meal.idMeal) ? "favorited" : ""
                }" aria-label="${
              isFavorite(meal.idMeal)
                ? "Remove from favorites"
                : "Add to favorites"
            }" title="Toggle favorite">
                  <i class="${
                    isFavorite(meal.idMeal) ? "fa-solid" : "fa-regular"
                  } fa-heart"></i>
                </button>
              </div>
            </div>
          `;
            card.querySelector(".fav-btn").onclick = (e) => {
              e.stopPropagation();
              toggleFavorite(meal);
              renderCards(meals);
            };
            card.querySelector(".view-btn").onclick = () =>
              openRecipeModal(meal);
            card.onkeypress = (e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                openRecipeModal(meal);
              }
            };
            cardsContainer.appendChild(card);
          });
          cardsContainer.setAttribute("aria-busy", "false");
          updateFavCount();
        }

        function splitInstructions(instr) {
          if (!instr) return [];
          let steps = instr.split(/\r?\n(?=\d+\.)/).filter(Boolean);
          if (steps.length > 1) return steps.map((s) => s.trim());
          steps = instr.split(/\r?\n/).filter((s) => s.trim());
          if (steps.length > 1) return steps.map((s) => s.trim());
          if (instr.includes(". ")) {
            steps = instr
              .split(". ")
              .map((s) => s.trim())
              .filter(Boolean);
            if (steps.length > 1) return steps;
          }
          return [instr.trim()];
        }

        function openRecipeModal(meal) {
          const ings = [];
          for (let i = 1; i <= 20; i++) {
            const ing = meal[`strIngredient${i}`];
            const measure = meal[`strMeasure${i}`];
            if (ing && ing.trim()) {
              ings.push({
                ing: ing.trim(),
                measure: measure ? measure.trim() : "",
              });
            }
          }
          const ingIcons = ings
            .map(
              ({ ing, measure }) => `
          <div class="ingredient-icon">
            <img src="https://www.themealdb.com/images/ingredients/${encodeURIComponent(
              ing
            )}.png" alt="${ing}">
            <span>${ing}${
                measure
                  ? `<br><span style='color:#aaa;font-size:0.8em;'>${measure}</span>`
                  : ""
              }</span>
          </div>
        `
            )
            .join("");
          const steps = splitInstructions(meal.strInstructions);
          modalRoot.innerHTML = `
          <div class="modal-bg" tabindex="-1" role="dialog" aria-modal="true" aria-label="Recipe details for ${
            meal.strMeal
          }">
            <div class="modal">
              <button class="modal-close" aria-label="Close modal">&times;</button>
              <img class="modal-img" src="${meal.strMealThumb}" alt="${
            meal.strMeal
          }" />
              <div class="modal-title">${meal.strMeal}</div>
              <div class="modal-section"><strong>Category:</strong> ${
                meal.strCategory || ""
              } &nbsp; <strong>Area:</strong> ${meal.strArea || ""}</div>
              <div class="modal-section modal-ingredients">${ingIcons}</div>
              <div class="modal-section"><strong>Step-by-step Instructions:</strong>
                <div style="margin-top:8px;">
                  ${steps
                    .map(
                      (step, i) =>
                        `<div class="modal-step"><b>Step ${
                          i + 1
                        }:</b> ${step}</div>`
                    )
                    .join("")}
                </div>
              </div>
              <div class="modal-bottom-row">
                ${
                  meal.strYoutube
                    ? `<a class="modal-youtube" href="${meal.strYoutube}" target="_blank" rel="noopener"><i class="fa-brands fa-youtube"></i> YouTube</a>`
                    : ""
                }
                <button class="modal-fav-btn ${
                  isFavorite(meal.idMeal) ? "favorited" : ""
                }" aria-label="Toggle favorite" title="Toggle favorite">
                  <i class="${
                    isFavorite(meal.idMeal) ? "fa-solid" : "fa-regular"
                  } fa-heart"></i>
                </button>
              </div>
            </div>
          </div>
        `;
          modalRoot.querySelector(".modal-close").onclick = closeRecipeModal;
          modalRoot.querySelector(".modal-bg").onclick = (e) => {
            if (e.target === modalRoot.querySelector(".modal-bg"))
              closeRecipeModal();
          };
          modalRoot.querySelector(".modal-fav-btn").onclick = (e) => {
            e.stopPropagation();
            toggleFavorite(meal);
            openRecipeModal(meal);
            renderCards(
              Array.from(cardsContainer.children)
                .map((card) => card.mealData)
                .filter(Boolean)
            );
          };
          modalRoot.querySelector(".modal").mealData = meal;
          document.body.style.overflow = "hidden";
          modalRoot.setAttribute("aria-hidden", "false");
        }
        function closeRecipeModal() {
          modalRoot.innerHTML = "";
          document.body.style.overflow = "auto";
          modalRoot.setAttribute("aria-hidden", "true");
        }

        document.getElementById("show-favorites").onclick = async () => {
          if (favorites.length === 0) {
            favModalRoot.innerHTML = `
            <div class="modal-bg" role="dialog" aria-modal="true" aria-label="Favorites">
              <div class="modal fav-modal">
                <button class="modal-close" aria-label="Close modal">&times;</button>
                <h2>Your Favorite Recipes</h2>
                <div class="no-results">No favorites yet. Click <span style="color:#e67e22;"><i class="fa-solid fa-heart"></i></span> on a recipe to add!</div>
              </div>
            </div>
          `;
            favModalRoot.querySelector(".modal-close").onclick = closeFavModal;
            favModalRoot.querySelector(".modal-bg").onclick = (e) => {
              if (e.target === favModalRoot.querySelector(".modal-bg"))
                closeFavModal();
            };
            document.body.style.overflow = "hidden";
            favModalRoot.setAttribute("aria-hidden", "false");
            return;
          }
          const mealsRaw = await Promise.all(
            favorites.map(async (id) => {
              const res = await fetch(
                `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`
              );
              const data = await res.json();
              return data.meals ? data.meals[0] : null;
            })
          );
          const meals = mealsRaw.filter(Boolean);
          favModalRoot.innerHTML = `
          <div class="modal-bg" role="dialog" aria-modal="true" aria-label="Favorites">
            <div class="modal fav-modal">
              <button class="modal-close" aria-label="Close modal">&times;</button>
              <h2>Your Favorite Recipes</h2>
              <div class="grid">
                ${meals
                  .map((meal) => {
                    const ings = getIngredients(meal, 4);
                    const ingIcons = ings
                      .map(
                        (ing) => `
                    <div class="ingredient-icon">
                      <img src="https://www.themealdb.com/images/ingredients/${encodeURIComponent(
                        ing
                      )}.png" alt="${ing}">
                      <span>${ing}</span>
                    </div>
                  `
                      )
                      .join("");
                    return `
                    <div class="card" tabindex="0" role="article" aria-label="${
                      meal.strMeal
                    }">
                      <img class="card-img" src="${meal.strMealThumb}" alt="${
                      meal.strMeal
                    }" loading="lazy" />
                      <div class="card-body">
                        <div class="card-title">${meal.strMeal}</div>
                        <div class="card-meta">${meal.strArea || ""} &middot; ${
                      meal.strCategory || ""
                    }</div>
                        <div class="ingredient-row">${ingIcons}</div>
                        <div class="card-footer">
                          <button class="view-btn" data-id="${
                            meal.idMeal
                          }" aria-label="View steps for ${
                      meal.strMeal
                    }">View Steps</button>
                          <button class="fav-btn favorited" data-id="${
                            meal.idMeal
                          }" aria-label="Remove from favorites" title="Remove from favorites">
                            <i class="fa-solid fa-heart"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  `;
                  })
                  .join("")}
              </div>
            </div>
          </div>
        `;
          favModalRoot.querySelectorAll(".fav-btn").forEach((btn) => {
            btn.onclick = (e) => {
              e.stopPropagation();
              const id = btn.getAttribute("data-id");
              const idx = favorites.indexOf(id);
              if (idx !== -1) {
                favorites.splice(idx, 1);
                localStorage.setItem("favorites", JSON.stringify(favorites));
                updateFavCount();
                document.getElementById("show-favorites").click();
              }
            };
          });
          favModalRoot.querySelectorAll(".view-btn").forEach((btn) => {
            btn.onclick = async (e) => {
              const id = btn.getAttribute("data-id");
              const res = await fetch(
                `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`
              );
              const data = await res.json();
              if (data.meals && data.meals[0]) openRecipeModal(data.meals[0]);
            };
          });
          favModalRoot.querySelector(".modal-close").onclick = closeFavModal;
          favModalRoot.querySelector(".modal-bg").onclick = (e) => {
            if (e.target === favModalRoot.querySelector(".modal-bg"))
              closeFavModal();
          };
          document.body.style.overflow = "hidden";
          favModalRoot.setAttribute("aria-hidden", "false");
        };
        function closeFavModal() {
          favModalRoot.innerHTML = "";
          document.body.style.overflow = "auto";
          favModalRoot.setAttribute("aria-hidden", "true");
        }

        // Search debounce
        const searchInput = document.getElementById("searchInput");
        const searchForm = document.getElementById("searchForm");
        searchForm.addEventListener("submit", (e) => {
          e.preventDefault();
          if (debounceTimeout) clearTimeout(debounceTimeout);
          debounceTimeout = setTimeout(() => {
            const val = searchInput.value.trim();
            if (val) fetchRecipes(val);
            else if (currentCategory) fetchRecipesByCategory(currentCategory);
            else fetchRecipes();
          }, 300);
        });

        fetchCategories();
        fetchRecipes();
        updateFavCount();
      })();
    </script>
  </body>
</html>
